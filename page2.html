<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>뉴스 속보</title>
  <style>
    body { margin: 0; overflow: hidden; background: #000; }
  
    .news-container {
      position: relative;
      width: 100vw;
      height: 100vh;
      background: url("images/news_bg.png") no-repeat center center;
      background-size: cover;
    }

    .breaking-news-text {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Apple SD Gothic Neo", sans-serif;
      position: absolute;
      bottom: 12.5%; 
      left: 50%;
      transform: translateX(-50%);
      width: 60%; 
      font-size: 3rem;
      font-weight: bold;
      text-align: center;
      color: black;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    /* 초록색 테마 로딩 화면 */
    #loadingOverlay {
      display: none;
      position: fixed; top: 0; left: 0; width: 100%; height: 100%;
      background: #000; z-index: 9999;
      flex-direction: column; align-items: center; justify-content: center;
      font-family: sans-serif;
    }
  </style>
</head>
<body>

<div class="news-container">
  <div class="breaking-news-text" id="newsHeadline">데이터 로딩중...</div>
</div>

<div id="loadingOverlay">
  <div id="loadingText" style="font-size:18px; margin-bottom:20px; color:#00ff00; font-weight:bold;">잠시만 기다려주세요...</div>
  <div style="width:200px; height:2px; background:#113311; overflow:hidden;">
    <div id="loadingBar" style="width:0%; height:100%; background:#00ff00; transition: width 1.8s linear;"></div>
  </div>
</div>

<button onclick="moveNext()" style="
  position: fixed; bottom: 20px; right: 20px;
  padding: 15px 25px; background: #fff; color: #000;
  border: 1px solid #a8a8a8; border-radius: 15px;
  cursor: pointer; z-index: 1000;
">
  다음으로 →
</button>

<script>
  // 1. 본인의 새 배포 URL로 교체하세요
  const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbwu3kZEfdIlqtOajT9bTmoZG9Ib02NSV9J8YRlZSHe19c92TM35Uhqu8PqBLxu1gITuzw/exec";
  const newsHeadlineEl = document.getElementById("newsHeadline");
  let lastFact = "";

  async function fetchLatest() {
    try {
      // 파라미터를 싹 비우고 URL만 호출합니다. (t=...는 캐시 방지용)
      const url = `${WEB_APP_URL}?t=${Date.now()}`;
      const res = await fetch(url);
      const data = await res.json();
      
      if (!data || !data.ok) return;
      
      // 구글 스크립트에서 보낸 필드명은 'latestNews'입니다.
      const fact = (data.latestNews || "").trim();
      
      if (!fact || fact === lastFact) return;
      
      lastFact = fact;
      newsHeadlineEl.textContent = fact;
      
      // 다른 컴퓨터에서도 똑같이 보려면 로컬스토리지는 이제 보조 수단으로만 씁니다.
      localStorage.setItem('currentNews', fact);
      
    } catch (e) {
      console.error("[page2] fetchLatest error:", e);
    }
  }

  // 3초마다 체크 (너무 빠르면 구글 서버에서 차단될 수 있어 3000ms 추천)
  fetchLatest();
  setInterval(fetchLatest, 3000);

  function moveNext() {
    // 이동 시 현재 화면에 떠 있는 텍스트를 한 번 더 확실히 저장
    localStorage.setItem('currentNews', newsHeadlineEl.textContent);

    const overlay = document.getElementById("loadingOverlay");
    const bar = document.getElementById("loadingBar");

    overlay.style.display = "flex";
    setTimeout(() => { bar.style.width = "100%"; }, 50);

    setTimeout(() => {
      window.location.href = 'page3.html';
    }, 2000);
  }
</script>
</body>
</html>
